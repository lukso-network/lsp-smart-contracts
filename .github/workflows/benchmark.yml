# This workflow benchmark the gas usage of Universal Profile for common interactions

name: ğŸ†™ ğŸ“Š Universal Profile Benchmark

on:
  pull_request_review:
    types: [submitted]
    branches: "develop"

jobs:
  benchmark:
    if: github.event.review.state == 'approved'
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Use Node.js '16.15.0'
        uses: actions/setup-node@v2
        with:
          node-version: "16.15.0"
          cache: "npm"

      - id: "reviews"
        uses: "jrylan/github-action-reviews-counter@main"
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"

      - name: ğŸ“¦ Install dependencies
        if: "steps.reviews.outputs.approved = 1"
        run: npm ci

      - name: ğŸ—ï¸ Build contract artifacts
        if: "steps.reviews.outputs.approved = 1"
        run: npm run build --if-present

      - name: ğŸ§ª Run Benchmark tests
        if: "steps.reviews.outputs.approved = 1"
        run: npm run test:benchmark

      - name: ğŸ“Š Generate Benchmark Report
        if: "steps.reviews.outputs.approved = 1"
        uses: peter-evans/create-or-update-comment@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body-file: "./benchmark.md"
